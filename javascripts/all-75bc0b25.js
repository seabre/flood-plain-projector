function setProjectionDate(){projectionDate=parseInt(this.dataset.value)}function fetch_tile(e,o,t){return e+t+"/"+o.x+"/"+o.y+".png"}function flood_fetch_tile(e,o){return fetch_tile("http://floodmap.floodplainprojector.com/flood/",e,o)}function osm_fetch_tile(e,o){return fetch_tile("http://a.tile.stamen.com/toner/",e,o)}function round_results(e){return Math.round(100*e)/100}function sea_level_rise(e,o){var t=e-1992;return.0017*t+o*Math.pow(t,2)}function sea_level_rise_starting_at(e,o,t){return sea_level_rise(o,t)-sea_level_rise(e,t)}function initialize(){elevator=new google.maps.ElevationService,hatchery_infowindow=new google.maps.InfoWindow;var e={minZoom:9,zoom:9,mapTypeId:"OSM",mapTypeControlOptions:{mapTypeIds:mapTypeIds,position:google.maps.ControlPosition.LEFT_BOTTOM},zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};map=new google.maps.Map(document.getElementById("map"),e),map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById("legend")),map.mapTypes.set("OSM",new google.maps.ImageMapType(osm_options)),map.overlayMapTypes.push(flood),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var o=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),t={location:o,radius:160900.34,query:"fish hatcheries near Nearby"},a=new google.maps.places.PlacesService(map);a.textSearch(t,callback),map.setCenter(o)},function(){handleNoGeolocation(!0)}):handleNoGeolocation(!1)}function handleNoGeolocation(e){if(e)var o="Error: The Geolocation service failed.";else var o="Error: Your browser doesn't support geolocation.";var t={map:map,position:new google.maps.LatLng(60,105),content:o};map.setCenter(t.position)}function callback(e,o){if(o==google.maps.places.PlacesServiceStatus.OK){for(var t=0;t<e.length;t++)createMarker(e[t]);var a=new google.maps.MVCArray(location_coords);heatmap=new google.maps.visualization.HeatmapLayer({data:a,radius:100}),console.log(map),heatmap.setMap(map)}}function createMarker(e){var o=e.geometry.location;locations.push(o),location_coords.push(o);var t=new google.maps.Marker({map:map,position:o});markers.push(t);var a={locations:locations};google.maps.event.addListener(t,"click",function(){loc=this,elevator.getElevationForLocations(a,function(o,t){if(t==google.maps.ElevationStatus.OK)if(o[0]){var a=(new Date).getFullYear();hatchery_infowindow.setContent('<div class="loc_marker"><h5>'+e.name+"</h5><strong>Elevation:</strong> "+round_results(o[0].elevation)+"m<br><strong>"+projectionDate+" Year Projection:</strong> "+round_results(o[0].elevation-sea_level_rise_starting_at(a,a+projectionDate,INTERMEDIATE_HIGH))+"m</div>"),hatchery_infowindow.open(map,loc)}else alert("No results found");else alert("Elevation service failed due to: "+t)})})}function toggleDensity(){heatmap.setMap(heatmap.getMap()?null:map)}function toggleMarkers(){for(var e=0;e<markers.length;e++){var o=markers[e];o.setVisible(!o.visible)}}for(var projectionDate=1,pdButtons=document.getElementsByClassName("projection-date"),i=0;i<pdButtons.length;i++)pdButtons[i].addEventListener("click",setProjectionDate,!1);var locations=[],location_coords=[],markers=[],map,elevator,hatchery_infowindow,mapTypeIds=[];for(var type in google.maps.MapTypeId)mapTypeIds.push(google.maps.MapTypeId[type]);mapTypeIds.push("OSM"),osm_options={getTileUrl:osm_fetch_tile,tileSize:new google.maps.Size(256,256),maxZoom:18,isPng:!0,name:"Toner"},flood_options={getTileUrl:flood_fetch_tile,tileSize:new google.maps.Size(256,256),isPng:!0},flood=new google.maps.ImageMapType(flood_options);var HIGHEST=156e-6,INTERMEDIATE_HIGH=871e-7,INTERMEDIATE_LOW=271e-7;google.maps.event.addDomListener(window,"load",initialize),toggle_density=document.getElementById("toggle_density"),toggle_markers=document.getElementById("toggle_markers"),toggle_density.addEventListener("click",toggleDensity,!1),toggle_markers.addEventListener("click",toggleMarkers,!1);