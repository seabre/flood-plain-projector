function fetch_tile(o,e,a){return o+a+"/"+e.x+"/"+e.y+".png"}function flood_fetch_tile(o,e){return fetch_tile("http://floodmap.floodplainprojector.com/flood/",o,e)}function osm_fetch_tile(o,e){return fetch_tile("http://a.tile.stamen.com/toner/",o,e)}function round_results(o){return Math.round(100*o)/100}function sea_level_rise(o,e){var a=o-1992;return.0017*a+e*Math.pow(a,2)}function sea_level_rise_starting_at(o,e,a){return sea_level_rise(e,a)-sea_level_rise(o,a)}function initialize(){elevator=new google.maps.ElevationService,hatchery_infowindow=new google.maps.InfoWindow;var o={minZoom:9,zoom:9,mapTypeId:"OSM",mapTypeControlOptions:{mapTypeIds:mapTypeIds,position:google.maps.ControlPosition.LEFT_BOTTOM},zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};map=new google.maps.Map(document.getElementById("map"),o),map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById("legend")),map.mapTypes.set("OSM",new google.maps.ImageMapType(osm_options)),map.overlayMapTypes.push(flood),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){var e=new google.maps.LatLng(o.coords.latitude,o.coords.longitude),a={location:e,radius:160900.34,query:"fish hatcheries near Nearby"},t=new google.maps.places.PlacesService(map);t.textSearch(a,callback),map.setCenter(e)},function(){handleNoGeolocation(!0)}):handleNoGeolocation(!1)}function handleNoGeolocation(o){if(o)var e="Error: The Geolocation service failed.";else var e="Error: Your browser doesn't support geolocation.";var a={map:map,position:new google.maps.LatLng(60,105),content:e};map.setCenter(a.position)}function callback(o,e){if(e==google.maps.places.PlacesServiceStatus.OK){for(var a=0;a<o.length;a++)createMarker(o[a]);var t=new google.maps.MVCArray(location_coords);heatmap=new google.maps.visualization.HeatmapLayer({data:t,radius:100}),console.log(map),heatmap.setMap(map)}}function createMarker(o){var e=o.geometry.location;locations.push(e),location_coords.push(e);var a=new google.maps.Marker({map:map,position:e});markers.push(a);var t={locations:locations};google.maps.event.addListener(a,"click",function(){loc=this,elevator.getElevationForLocations(t,function(e,a){if(a==google.maps.ElevationStatus.OK)if(e[0]){var t=(new Date).getFullYear();hatchery_infowindow.setContent('<div class="loc_marker"><h5>'+o.name+"</h5><strong>Elevation:</strong> "+round_results(e[0].elevation)+"m<br><strong>"+projectionDate+" Year Projection:</strong> "+round_results(e[0].elevation-sea_level_rise_starting_at(t,t+projectionDate,INTERMEDIATE_HIGH))+"m</div>"),hatchery_infowindow.open(map,loc)}else alert("No results found");else alert("Elevation service failed due to: "+a)})})}var locations=[],location_coords=[],markers=[],map,elevator,hatchery_infowindow,mapTypeIds=[];for(var type in google.maps.MapTypeId)mapTypeIds.push(google.maps.MapTypeId[type]);mapTypeIds.push("OSM"),osm_options={getTileUrl:osm_fetch_tile,tileSize:new google.maps.Size(256,256),maxZoom:18,isPng:!0,name:"Toner"},flood_options={getTileUrl:flood_fetch_tile,tileSize:new google.maps.Size(256,256),isPng:!0},flood=new google.maps.ImageMapType(flood_options);var HIGHEST=156e-6,INTERMEDIATE_HIGH=871e-7,INTERMEDIATE_LOW=271e-7;google.maps.event.addDomListener(window,"load",initialize);